(function(b){var a={},d=b(window),c=b(document);a.onReady=function(){var j="comment_mail",t="comment-mail",l=b("."+t+"-menu-page"),m=b("."+t+"-menu-page-area"),q=b("."+t+"-menu-page-table"),n=b("."+t+"-menu-page-form"),i=b("."+t+"-menu-page-queue"),h=b("."+t+"-menu-page-stats"),o=window[j+"_vars"],u=window[j+"_i18n"],k={search_contains:true,disable_search_threshold:10,allow_single_deselect:true},p=[],s={tabSize:3,lineNumbers:false,matchBrackets:true,indentWithTabs:true,theme:o.templateSyntaxTheme,extraKeys:{F11:function(v){if(v.getOption("fullScreen")){v.setOption("fullScreen",false);b("#adminmenuwrap, #wpadminbar").show()}else{v.setOption("fullScreen",true);b("#adminmenuwrap, #wpadminbar").hide()}}}};m.find(".pmp-tabs > a").on("click",function(A){A.preventDefault();A.stopImmediatePropagation();var z=b(this),w=z.parent().find("> a"),x=z.parent().next(".pmp-tab-panes"),v=x.children(),y=x.find("> "+z.data("target"));w.add(v).removeClass("pmp-active");v.hide();z.add(y).addClass("pmp-active");y.show()});m.find("[data-pmp-action]").on("click",function(x){x.preventDefault();x.stopImmediatePropagation();var w=b(this),v=w.data();if(typeof v.pmpConfirmation!=="string"||confirm(v.pmpConfirmation)){location.href=v.pmpAction}});m.find('[data-toggle~="date-time-picker"]').datetimepicker({lang:"en",lazyInit:true,validateOnBlur:false,format:"M j, Y H:i",i18n:u.dateTimePickerI18n});m.find('[data-toggle~="select-all"]').on("click",function(){b(this).select()});m.find('[data-toggle~="alert"]').on("click",function(y){y.preventDefault();y.stopImmediatePropagation();var x=b(this),A=x.closest("table,div"),w=x.data("alert"),z=b('<div class="pmp-modal-dialog-overlay"></div>'),v=b('<div class="pmp-modal-dialog">   <a class="pmp-modal-dialog-close"></a>   '+w+"</div>");A.after(z).after(v);z.add(v.find("> .pmp-modal-dialog-close")).on("click",function(B){B.preventDefault();B.stopImmediatePropagation();m.find(".pmp-modal-dialog").remove();m.find(".pmp-modal-dialog-overlay").remove()})});l.find("[data-cm-mode]").each(function(){var x=b(this),v=x.data("cmMode"),w=x.data("cmHeight"),y=x.find("textarea");if(y.length!==1){return}window.CodeMirror=CodeMirror||{fromTextArea:function(){}};x.addClass("cm");p.push(CodeMirror.fromTextArea(y[0],b.extend({},s,{mode:v})));p[p.length-1].setSize(null,w)});var e=function(){b.each(p,function(v,w){w.refresh()})};l.find('[data-toggle~="other"]').on("click",function(v){v.preventDefault();v.stopImmediatePropagation();b(b(this).data("other")).toggle();e()});l.find(".pmp-panels-open").on("click",function(){l.find(".pmp-panel-heading").addClass("open").next(".pmp-panel-body").addClass("open");e()});l.find(".pmp-panels-close").on("click",function(){l.find(".pmp-panel-heading").removeClass("open").next(".pmp-panel-body").removeClass("open");e()});l.find(".pmp-panel-heading").on("click",function(v){v.preventDefault();v.stopImmediatePropagation();b(this).toggleClass("open").next(".pmp-panel-body").toggleClass("open");e()});l.find(".pmp-if-change").on("change",function(){var G=b(this),B=b.trim(G.val()),D=G.closest(".pmp-panel"),I=G.closest(".pmp-if-nest"),E=D;if(I.length){E=I}var v=G.hasClass("pmp-if-value-match");var F=B!==""&&B!=="0",C=!F;var A=".pmp-if-enabled",y=".pmp-if-enabled-show",z=".pmp-if-disabled",x=".pmp-if-disabled-show";var w=function(){return I.length?false:b(this).hasClass("pmp-in-if-nest")};var H=function(){return !v?true:b(this).hasClass("pmp-if-value-"+B)};if(F){if(v){E.find(A+","+y).not(w).not(H).css("opacity",0.2).find(":input").attr("disabled","disabled");E.find(y).not(w).not(H).hide()}E.find(A+","+y).not(w).filter(H).show().css("opacity",1).find(":input").removeAttr("disabled")}else{E.find(A+","+y).not(w).css("opacity",0.2).find(":input").attr("disabled","disabled");E.find(y).not(w).hide()}if(C){E.find(z+","+x).not(w).show().css("opacity",1).find(":input").removeAttr("disabled")}else{E.find(z+","+x).not(w).css("opacity",0.2).find(":input").attr("disabled","disabled");E.find(x).not(w).hide()}e()}).trigger("change");q.find("> form").on("submit",function(){var z=b(this),w=z.find("#bulk-action-selector-top"),y=z.find("#bulk-action-selector-bottom"),x=w.val(),v=y.val();if(x==="reconfirm"||v==="reconfirm"){return confirm(u.bulkReconfirmConfirmation)}else{if(x==="delete"||v==="delete"){return confirm(u.bulkDeleteConfirmation)}else{return true}}});var g={$select:n.find("> form tr.pmp-sub-form-post-id select"),$input:n.find("> form tr.pmp-sub-form-post-id input"),progress:'<img src="'+o.pluginUrl+'/src/client-s/images/tiny-progress-bar.gif" class="pmp-progress" />'};if(g.$select.length){g.lastId=b.trim(g.$select.val())}else{g.lastId=b.trim(g.$input.val())}g.handler=function(){var w=b(this),x={},v={};g.newId=b.trim(w.val());if(g.newId===g.lastId){return}g.lastId=g.newId;x.$lastRow=n.find("> form tr.pmp-sub-form-comment-id");x.$lastChosenContainer=x.$lastRow.find(".chosen-container");x.$lastInput=x.$lastRow.find(":input");if(!x.$lastRow.length||!x.$lastInput.length){return}x.$lastChosenContainer.remove();x.$lastInput.replaceWith(b(g.progress));v[j]={sub_form_comment_id_row_via_ajax:{post_id:g.newId}};b.get(o.ajaxEndpoint,v,function(y){x.$newRow=b(y);x.$lastRow.replaceWith(x.$newRow);x.$newRow.find("select").chosen(k)})};var r={$select:n.find("> form tr.pmp-sub-form-user-id select"),$input:n.find("> form tr.pmp-sub-form-user-id input"),$progress:b('<img src="'+o.pluginUrl+'/src/client-s/images/tiny-progress-bar.gif" class="pmp-progress" />')};if(r.$select.length){r.lastId=b.trim(r.$select.val())}else{r.lastId=b.trim(r.$input.val())}r.handler=function(){var B=b(this),C,z,v,A,x,w,D,y={};r.newId=b.trim(B.val());if(r.newId===r.lastId){return}r.lastId=r.newId;C=n.find("> form tr.pmp-sub-form-email th");z=n.find("> form tr.pmp-sub-form-email input");v=n.find("> form tr.pmp-sub-form-fname input");A=n.find("> form tr.pmp-sub-form-lname input");x=n.find("> form tr.pmp-sub-form-insertion-ip input");w=n.find("> form tr.pmp-sub-form-insertion-region input");D=n.find("> form tr.pmp-sub-form-insertion-country input");if(!C.length||(z.length+v.length+A.length)<1){return}r.$progress.remove();C.append(r.$progress);y[j]={sub_form_user_id_info_via_ajax:{user_id:r.newId}};b.get(o.ajaxEndpoint,y,function(E){z.val(E.email);v.val(E.fname);A.val(E.lname);x.val(E.ip);w.val(E.region);D.val(E.country);r.$progress.remove()})};g.$select.on("change",g.handler).chosen(k);g.$input.on("blur",g.handler);n.find("> form tr.pmp-sub-form-comment-id select").chosen(k);r.$select.on("change",r.handler).chosen(k);r.$input.on("blur",r.handler);n.find("> form tr.pmp-sub-form-status select").on("change",function(){var y=b(this),v=b.trim(y.val()),w=y.siblings(".checkbox"),x=w.find("input");if(v==="unconfirmed"){w.show()}else{x.prop("checked",false);w.hide()}}).trigger("change").chosen(k);n.find("> form tr.pmp-sub-form-deliver select").chosen(k);n.find("> form").on("submit",function(x){var w=b(this),y="",v=[];w.find(".form-required :input[required]").each(function(){var z=b(this),A=b.trim(z.val());if(typeof A==="undefined"||A==="0"||A===""){v.push(this)}});b.each(v,function(){y+=b.trim(w.find('label[for="'+this.id+'"]').text().replace(/\s+/g," "))+"\n"});if((y=b.trim(y)).length){x.preventDefault();x.stopImmediatePropagation();alert(y);return false}});Chart.types.Bar.extend({name:"BetterBar",initialize:function(v){Chart.types.Bar.prototype.initialize.apply(this,arguments);b.each(this.datasets,function(w,x){b.each(x.bars,function(y,z){if(v.datasets[w].percent instanceof Array){z.percent=v.datasets[w].percent[y]}})})}});Chart.BetterBar=Chart.BetterBar||function(){};i.find(".pmp-process-queue-manually").on("click",function(){b(this).find("> i").removeClass("fa-paper-plane").addClass("fa-refresh fa-spin")});if(h.length){postboxes.save_state=postboxes.save_order=function(){};postboxes.add_postbox_toggles(window.pagenow)}var f={$selects:h.find(".pmp-stats-view select"),$buttons:h.find(".pmp-stats-view button"),progress:'<img src="'+o.pluginUrl+'/src/client-s/images/tiny-progress-bar.gif" class="pmp-progress" />',chartOps:{responsive:true},geoChartOps:{displayMode:"regions"}};f.handler=function(){var y=b(this),D=y.closest("form"),C=y.closest(".pmp-stats-view"),w=C.find(".pmp-note.pmp-error"),z=C.find(".pmp-progress"),A=C.find(".pmp-canvas"),B=C.data("view"),x=C.find('select[name$="\\[type\\]"]').val(),v=C.data("chart");if(v&&typeof v.destroy==="function"){v.destroy()}if(v&&typeof v.clearChart==="function"){v.clearChart()}C.data("chart",null);w.remove();A.remove();z.remove();C.append(z=b(f.progress));if(/(?:^|_)geo(?:_|$)/i.test(x)){b.get(o.ajaxEndpoint,D.serialize(),function(I){if(!I){return}if(typeof I.errors==="string"){C.append(b(I.errors));z.remove();return}A=b('<div class="pmp-canvas"></div>');C.append(A);var H=new google.visualization.DataTable(),F=I.data.shift(),E=b.extend({},f.geoChartOps,I.options),G=new google.visualization.GeoChart(A[0]);H.addColumn("string","region",F[0]);H.addColumn("number","value",F[1]);H.addColumn({type:"string",role:"tooltip"});H.addRows(I.data);G.draw(H,E);C.data("chart",G);z.remove()})}else{b.get(o.ajaxEndpoint,D.serialize(),function(G){if(!G){return}if(typeof G.errors==="string"){C.append(b(G.errors));z.remove();return}A=b('<canvas class="pmp-canvas"></canvas>');C.append(A);var H=A.get(0).getContext("2d"),E=b.extend({},f.chartOps,G.options),F=new Chart(H).BetterBar(G.data,E);C.data("chart",F);z.remove()})}};f.$selects.chosen(k);f.$buttons.on("click",f.handler);f.$buttons.filter("[data-auto-chart]").trigger("click");f.$selects.filter('[name$="\\[type\\]"]').on("change",function(){var x=b(this),y=x.val(),v=x.closest(".pmp-stats-view"),w=v.find("tr.pmp-stats-form-by");w.css({opacity:/(?:^|_)(?:popular_posts|geo)(?:_|$)/i.test(y)?0.2:1})}).trigger("change")};c.ready(a.onReady)})(jQuery);